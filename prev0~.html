<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Шахматы с ИИ (новичковый стиль)</title>
<style>
 body {
   background: linear-gradient(#ddd6f3, #faaca8);
   font-family: Arial;
   margin:0;
   padding:20px;
   text-align:center;
 }
 h1 {margin:10px;}
 #board {margin:10px auto; border:3px solid #333; width:480px; max-width:95vw;}
 table {border-collapse:collapse; width:100%; table-layout:fixed;}
 td {
   width:12.5%; height:12.5vw;
   max-height:60px; max-width:60px;
   text-align:center; vertical-align:middle;
   font-size:7vw; max-font-size:40px;
   cursor:pointer;
 }
 .light{background:#f5e1c4}
 .dark{background:#b97a57}
 .selected{outline:3px solid yellow}
 .hint{background:radial-gradient(circle, rgba(255,255,0,0.5) 40%, transparent 41%)}
 #info{margin:10px auto;}
 button{padding:6px 10px; margin:4px}
 footer{font-size:12px; margin-top:12px; color:#333}
 .board-wrap{border:1px solid #333; padding:6px; background:#fff; display:inline-block}
</style>
</head>
<body>
<h1>Шахматы с ИИ</h1>
<div class="board-wrap">
  <div id="board"></div>
</div>
<div id="info">
  <div id="turn">Ход: белые</div>
  <button id="reset">Сбросить</button>
</div>
<footer>Шахматы с ИИ среднего уровня (код в стиле новичка).</footer>

<script>
var piecesStart = [
 ["r","n","b","q","k","b","n","r"],
 ["p","p","p","p","p","p","p","p"],
 ["","","","","","","",""],
 ["","","","","","","",""],
 ["","","","","","","",""],
 ["","","","","","","",""],
 ["P","P","P","P","P","P","P","P"],
 ["R","N","B","Q","K","B","N","R"]
];
var glyph = {
 'r':'♜','n':'♞','b':'♝','q':'♛','k':'♚','p':'♟',
 'R':'♖','N':'♘','B':'♗','Q':'♕','K':'♔','P':'♙','':''
};

var board, selected, whiteTurn, possibleMoves;
var castling={whiteK:true, whiteQ:true, blackK:true, blackQ:true};
var enPassant=null; // клетка для "взятия на проходе"

function init(){
 board = JSON.parse(JSON.stringify(piecesStart));
 selected=null; whiteTurn=true; possibleMoves=[];
 castling={whiteK:true, whiteQ:true, blackK:true, blackQ:true};
 enPassant=null;
 renderBoard();
 document.getElementById("turn").innerText="Ход: белые";
}

function renderBoard(){
 var wrap=document.getElementById("board");
 var html="<table>";
 for(var r=0;r<8;r++){
   html+="<tr>";
   for(var c=0;c<8;c++){
     var color=((r+c)%2==0)?'light':'dark';
     var piece=board[r][c]||"";
     var disp=glyph[piece]||"";
     var extra="";
     if(selected && selected.r==r && selected.c==c) extra=" selected";
     if(possibleMoves.some(function(m){return m.r==r&&m.c==c})) extra+=" hint";
     html+='<td class="'+color+extra+'" data-r="'+r+'" data-c="'+c+'">'+disp+'</td>';
   }
   html+="</tr>";
 }
 html+="</table>";
 wrap.innerHTML=html;
 var tds=wrap.getElementsByTagName("td");
 for(var i=0;i<tds.length;i++){
   tds[i].onclick=onCellClick;
 }
}

function onCellClick(e){
 if(!whiteTurn) return;
 var td=e.currentTarget;
 var r=parseInt(td.dataset.r), c=parseInt(td.dataset.c);
 var piece=board[r][c];
 if(!selected){
   if(piece && isWhite(piece)){
     selected={r:r,c:c};
     possibleMoves=calcMoves(r,c,true);
   }
 } else {
   if(selected.r==r && selected.c==c){
     selected=null; possibleMoves=[];
   } else if(possibleMoves.some(function(m){return m.r==r&&m.c==c})){
     movePiece(selected.r,selected.c,r,c);
     whiteTurn=false;
     document.getElementById("turn").innerText="Ход: чёрные (ИИ)";
     setTimeout(aiMove,600);
   } else {
     if(piece && isWhite(piece)){
       selected={r:r,c:c};
       possibleMoves=calcMoves(r,c,true);
     } else {
       selected=null; possibleMoves=[];
     }
   }
 }
 renderBoard();
}

function movePiece(sr,sc,dr,dc){
 var piece=board[sr][sc];
 // Взятие на проходе
 if(piece=="P" && enPassant && dr==enPassant.r && dc==enPassant.c){
   board[dr][dc]=piece; board[sr][sc]="";
   board[dr+1][dc]=""; // убираем пешку чёрных
 }
 else if(piece=="p" && enPassant && dr==enPassant.r && dc==enPassant.c){
   board[dr][dc]=piece; board[sr][sc]="";
   board[dr-1][dc]=""; // убираем пешку белых
 }
 else {
   board[dr][dc]=piece;
   board[sr][sc]="";
 }
 // Превращение пешки
 if(piece=="P" && dr==0) board[dr][dc]="Q";
 if(piece=="p" && dr==7) board[dr][dc]="q";

 // Рокировка
 if(piece=="K" && sc==4 && (dc==6||dc==2)){
   if(dc==6){board[7][5]="R"; board[7][7]="";}
   if(dc==2){board[7][3]="R"; board[7][0]="";}
   castling.whiteK=false; castling.whiteQ=false;
 }
 if(piece=="k" && sc==4 && (dc==6||dc==2)){
   if(dc==6){board[0][5]="r"; board[0][7]="";}
   if(dc==2){board[0][3]="r"; board[0][0]="";}
   castling.blackK=false; castling.blackQ=false;
 }

 // Сброс en passant и установка новой
 enPassant=null;
 if(piece=="P" && sr==6 && dr==4) enPassant={r:5,c:sc};
 if(piece=="p" && sr==1 && dr==3) enPassant={r:2,c:sc};

 selected=null; possibleMoves=[];
}

function isWhite(p){return p==p.toUpperCase() && p!="";}
function isBlack(p){return p==p.toLowerCase() && p!="";}

// --- правила ходов ---
function calcMoves(r,c,isWhiteSide){
 var piece=board[r][c];
 var moves=[];
 if(!piece) return moves;

 // пешка
 if(piece=="P"){
   if(r>0 && !board[r-1][c]) moves.push({r:r-1,c:c});
   if(r==6 && !board[5][c] && !board[4][c]) moves.push({r:4,c:c});
   if(r>0 && c>0 && isBlack(board[r-1][c-1])) moves.push({r:r-1,c:c-1});
   if(r>0 && c<7 && isBlack(board[r-1][c+1])) moves.push({r:r-1,c:c+1});
   // en passant
   if(enPassant && r==3 && Math.abs(c-enPassant.c)==1) moves.push({r:enPassant.r,c:enPassant.c});
 }
 if(piece=="p"){
   if(r<7 && !board[r+1][c]) moves.push({r:r+1,c:c});
   if(r==1 && !board[2][c] && !board[3][c]) moves.push({r:3,c:c});
   if(r<7 && c>0 && isWhite(board[r+1][c-1])) moves.push({r:r+1,c:c-1});
   if(r<7 && c<7 && isWhite(board[r+1][c+1])) moves.push({r:r+1,c:c+1});
   if(enPassant && r==4 && Math.abs(c-enPassant.c)==1) moves.push({r:enPassant.r,c:enPassant.c});
 }

 // ладья
 if(piece.toLowerCase()=="r") addLineMoves(r,c,moves,[[-1,0],[1,0],[0,-1],[0,1]],piece);
 // слон
 if(piece.toLowerCase()=="b") addLineMoves(r,c,moves,[[-1,-1],[-1,1],[1,-1],[1,1]],piece);
 // ферзь
 if(piece.toLowerCase()=="q") addLineMoves(r,c,moves,[[-1,0],[1,0],[0,-1],[0,1],[-1,-1],[-1,1],[1,-1],[1,1]],piece);
 // конь
 if(piece.toLowerCase()=="n") addStepMoves(r,c,moves,[[2,1],[2,-1],[-2,1],[-2,-1],[1,2],[1,-2],[-1,2],[-1,-2]],piece);
 // король
 if(piece.toLowerCase()=="k"){
   addStepMoves(r,c,moves,[[-1,0],[1,0],[0,-1],[0,1],[-1,-1],[-1,1],[1,-1],[1,1]],piece);
   // рокировка
   if(piece=="K" && r==7 && c==4){
     if(castling.whiteK && !board[7][5] && !board[7][6]) moves.push({r:7,c:6});
     if(castling.whiteQ && !board[7][1] && !board[7][2] && !board[7][3]) moves.push({r:7,c:2});
   }
   if(piece=="k" && r==0 && c==4){
     if(castling.blackK && !board[0][5] && !board[0][6]) moves.push({r:0,c:6});
     if(castling.blackQ && !board[0][1] && !board[0][2] && !board[0][3]) moves.push({r:0,c:2});
   }
 }
 return moves;
}

function addLineMoves(r,c,moves,dirs,piece){
 for(var i=0;i<dirs.length;i++){
   var d=dirs[i], nr=r+d[0], nc=c+d[1];
   while(nr>=0&&nr<8&&nc>=0&&nc<8){
     if(!board[nr][nc]) moves.push({r:nr,c:nc});
     else {
       if(isWhite(piece)&&isBlack(board[nr][nc])) moves.push({r:nr,c:nc});
       if(isBlack(piece)&&isWhite(board[nr][nc])) moves.push({r:nr,c:nc});
       break;
     }
     nr+=d[0]; nc+=d[1];
   }
 }
}
function addStepMoves(r,c,moves,steps,piece){
 for(var i=0;i<steps.length;i++){
   var s=steps[i], nr=r+s[0], nc=c+s[1];
   if(nr>=0&&nr<8&&nc>=0&&nc<8){
     if(!board[nr][nc]) moves.push({r:nr,c:nc});
     else {
       if(isWhite(piece)&&isBlack(board[nr][nc])) moves.push({r:nr,c:nc});
       if(isBlack(piece)&&isWhite(board[nr][nc])) moves.push({r:nr,c:nc});
     }
   }
 }
}

// ИИ среднего уровня
var pieceValue={p:1,n:3,b:3,r:5,q:9,k:100};
function aiMove(){
 var allMoves=[];
 for(var r=0;r<8;r++){
   for(var c=0;c<8;c++){
     if(isBlack(board[r][c])){
       var moves=calcMoves(r,c,false);
       for(var i=0;i<moves.length;i++){
         var m=moves[i];
         var target=board[m.r][m.c]||"";
         var val=isWhite(target)?pieceValue[target.toLowerCase()]||0:0;
         allMoves.push({sr:r,sc:c,dr:m.r,dc:m.c,score:val});
       }
     }
   }
 }
 if(allMoves.length>0){
   allMoves.sort(function(a,b){return b.score-a.score;});
   var best=allMoves[0];
   movePiece(best.sr,best.sc,best.dr,best.dc);
 }
 whiteTurn=true;
 document.getElementById("turn").innerText="Ход: белые";
 renderBoard();
}

document.getElementById("reset").onclick=init;
init();
</script>
</body>
</html>

